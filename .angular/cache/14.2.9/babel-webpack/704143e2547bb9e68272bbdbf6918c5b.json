{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { UsersComponent } from '../dashboard/users/users.component';\nimport { ReportsComponent } from '../dashboard/reports/reports.component';\nlet DashboardComponent = class DashboardComponent {\n  constructor(_snackBar, signPostSrvc, productSrvc, userSrvc, router) {\n    this._snackBar = _snackBar;\n    this.signPostSrvc = signPostSrvc;\n    this.productSrvc = productSrvc;\n    this.userSrvc = userSrvc;\n    this.router = router;\n    this.displayedColumns = ['productCode', 'status', 'price', 'createdAt', 'updatedAt', 'action'];\n    this.stats = {\n      total: 0,\n      sold: 0,\n      available: 0,\n      revenue: 0\n    };\n    this.hotspotsPrivate = [// {\n      //     propertyId: \"ced3bc57-a4bc-41e6-9b48-782c249fe044\",\n      //     \"propertyName\": \"Riviera Varsity Lodge\",\n      //     \"geoLocation\": {\n      //         \"latitude\": -26.58495,\n      //         \"longitude\": 28.02231\n      //     },\n      //     \"weight\": 0.9\n      // },\n      // {\n      //     \"propertyId\": \"95f02764-c9d7-4966-a3e0-c1456a69e482\",\n      //     \"propertyName\": \"Miami Building\",\n      //     \"geoLocation\": {\n      //         \"latitude\": 0,\n      //         \"longitude\": 0\n      //     },\n      //     \"weight\": 0\n      // },\n      // {\n      //     \"propertyId\": \"7f763d29-57d5-4442-ac3e-0f474d6445d2\",\n      //     \"propertyName\": \"Nomndeni Lodge 1\",\n      //     \"geoLocation\": {\n      //         \"latitude\": -25.498156,\n      //         \"longitude\": 30.9899791\n      //     },\n      //     \"weight\": 0.3\n      // },\n      // {\n      //     \"propertyId\": \"697c0402-8c06-4694-bc4c-2b8d5efd02fc\",\n      //     \"propertyName\": \"Old Hebron College of Education\",\n      //     \"geoLocation\": {\n      //         \"latitude\": -25.5126819,\n      //         \"longitude\": 28.0552803\n      //     },\n      //     \"weight\": 0\n      // },\n      // {\n      //     \"propertyId\": \"7bce9374-9b6c-48a5-900c-4583c77f02bb\",\n      //     \"propertyName\": \"Respublica West City\",\n      //     \"geoLocation\": {\n      //         \"latitude\": -25.7556031,\n      //         \"longitude\": 28.11672\n      //     },\n      //     \"weight\": 0\n      // },\n      // {\n      //     \"propertyId\": \"35389abf-5007-4bf4-8522-84497a161f84\",\n      //     \"propertyName\": \"Tshwane Varsity Lodge 2\",\n      //     \"geoLocation\": {\n      //         \"latitude\": -25.7414709,\n      //         \"longitude\": 28.15231\n      //     },\n      //     \"weight\": 0\n      // },\n      // {\n      //     \"propertyId\": \"bc459efb-f4bb-4bb6-a181-90774d3ca162\",\n      //     \"propertyName\": \"Everest Towers\",\n      //     \"geoLocation\": {\n      //         \"latitude\": 0,\n      //         \"longitude\": 0\n      //     },\n      //     \"weight\": 0.3\n      // },\n      // {\n      //     \"propertyId\": \"5f84f406-3e2e-46a5-9022-4ab41fd48ee6\",\n      //     \"propertyName\": \"Muzinda\",\n      //     \"geoLocation\": {\n      //         \"latitude\": -25.7599894,\n      //         \"longitude\": 28.1377809\n      //     },\n      //     \"weight\": 0\n      // },\n      // {\n      //     \"propertyId\": \"80380203-18c6-4c71-8b9f-13cc5d00644f\",\n      //     \"propertyName\": \"Arebeng 2\",\n      //     \"geoLocation\": {\n      //         \"latitude\": 0,\n      //         \"longitude\": 0\n      //     },\n      //     \"weight\": 0.3\n      // }\n    ];\n    this.fileExtension = null;\n    this.loading = true;\n    this.userSrvc.getActiveUser().subscribe(user => {\n      //console.log(user);\n      if (!user || user.role != 'ADMIN') {\n        this.router.navigate(['/']);\n      }\n    });\n  }\n\n  ngOnInit() {\n    this.productSrvc.getProducts().then(resp => {\n      // tslint:disable-next-line: comment-format\n      //console.log(resp);\n      if (resp.products.length > 0) {\n        // tslint:disable-next-line: prefer-const\n        let products = resp.products;\n        console.table(products);\n        this.statsGenerator(products);\n        this.dataSource = new MatTableDataSource(products);\n        this.dataSource.paginator = this.paginator;\n        this.loading = false;\n      }\n    }).then(error => {// tslint:disable-next-line: comment-format\n      //console.log(error);\n    });\n    this.getUsers();\n  }\n\n  getUsers() {\n    this.loading = true;\n    this.userSrvc.getUsers().then(resp => {\n      this.userCount = resp.count;\n      console.log(this.userCount);\n    }).catch(error => {\n      this.loading = false;\n    });\n  }\n\n  applyFilter(event) {\n    const filterValue = event.value;\n    this.dataSource.filter = filterValue.trim().toLowerCase();\n  }\n\n  statsGenerator(vouchers) {\n    this.stats = {\n      total: 0,\n      sold: 0,\n      available: 0,\n      revenue: 0\n    };\n\n    for (let index = 0; index < vouchers.length; index++) {\n      const element = vouchers[index];\n\n      if (element.status === 'DISPENSED') {\n        this.stats.sold++;\n      }\n    }\n\n    this.stats.total = vouchers.length;\n    this.stats.available = this.stats.total - this.stats.sold;\n    this.stats.revenue = this.stats.sold * this.price;\n  }\n\n  onFileSelected(event) {\n    let selectedfile = event.target.files[0];\n    let filename = selectedfile.name;\n    filename = filename.split('.');\n    this.selectedfile = selectedfile;\n    let fileExtension = filename[filename.length - 1];\n    this.fileExtension = fileExtension; // tslint:disable-next-line: comment-format\n    ////console.log(this.fileExtension);\n\n    if (fileExtension != 'xlsx' && fileExtension != 'xlsb') {\n      this.openSnackBar('Only excel files are supported', 'Close');\n      return;\n    }\n\n    this.loading = true;\n    this.getUrl(selectedfile, fileExtension);\n  }\n\n  getUrl(selectedfile, fileExtension) {\n    //this.loader = true;\n    let dataObject;\n    let formData = new FormData();\n    this.signPostSrvc.getpresignedurls(fileExtension).then(res => {\n      dataObject = res;\n      Object.keys(dataObject.presignedPost.fields).forEach(key => {\n        formData.append(key, dataObject.presignedPost.fields[key]);\n      });\n      formData.append('file', selectedfile);\n      this.uploadFile(dataObject.presignedPost.url, formData);\n    });\n  }\n\n  uploadFile(url, formData) {\n    this.signPostSrvc.uploadFile(url, formData).then(resp => {\n      // tslint:disable-next-line:comment-format\n      //this.loader = false;\n      // tslint:disable-next-line:comment-format\n      //console.log(resp);\n      // this.getVouchers();\n      this.openSnackBar('Funding Records Uploaded Successful', 'Close');\n    }).catch(error => {\n      // tslint:disable-next-line: comment-format\n      //this.loader = false;\n      // tslint:disable-next-line: comment-format\n      //console.log(error);\n      this.loading = true;\n      this.openSnackBar('Something went wrong, please contact support', 'Close');\n    });\n  }\n\n  openSnackBar(message, action) {\n    this._snackBar.open(message, action, {\n      duration: 5500,\n      verticalPosition: 'top',\n      horizontalPosition: 'center'\n    });\n  }\n\n  deleteProduct(id) {\n    this.productSrvc.getDeleteProduct(id).then(resp => {\n      console.log(resp);\n    });\n  }\n\n  updateProduct(product) {\n    return this.router.navigate(['edit-product/'], {\n      state: {\n        data: product\n      }\n    }); // this.productSrvc.getUpdateProduct(id,this.product).then(resp => {\n    //   console.log(resp);\n    //  }\n    // )\n  }\n\n  createProduct() {\n    return this.router.navigate(['create-product/']); // this.productSrvc.getUpdateProduct(id,this.product).then(resp => {\n    //   console.log(resp);\n    //  }\n    // )\n  }\n\n  assignComponent(component) {\n    if (component === 'users') {\n      this.selectedComponent = UsersComponent;\n    } else if (component === 'reports') {\n      this.selectedComponent = ReportsComponent;\n    }\n  }\n\n};\n\n__decorate([ViewChild('chartRef', {\n  static: true\n})], DashboardComponent.prototype, \"chartRef\", void 0);\n\n__decorate([ViewChild(MatPaginator, {\n  static: true\n})], DashboardComponent.prototype, \"paginator\", void 0);\n\nDashboardComponent = __decorate([Component({\n  selector: 'app-dashboard',\n  templateUrl: './dashboard.component.html',\n  styleUrls: ['./dashboard.component.scss']\n})], DashboardComponent);\nexport { DashboardComponent };","map":null,"metadata":{},"sourceType":"module"}